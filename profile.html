<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>QUANTUM RIO – Profile</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyC6jW448tW3e8m6XVGjOegT8IGJQJERweY",
  authDomain: "quantum-rio-uganda.firebaseapp.com",
  databaseURL: "https://quantum-rio-uganda-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "quantum-rio-uganda",
  storageBucket: "quantum-rio-uganda.appspot.com",
  messagingSenderId: "840875099079",
  appId: "1:840875099079:web:1cd06a78276842a787cfe2",
  measurementId: "G-97G1PNQ9JB"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();
</script>

<style>
body {
  margin: 0;
  font-family: Arial, Helvetica, sans-serif;
  background: linear-gradient(135deg, #001f3f, #002f6c, #3a0ca3);
  color: #fff;
  padding-bottom: 1.5cm;
  overflow-x: hidden;
}

/* Loader */
.loader-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 10, 40, 0.95);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
  transition: opacity 0.4s ease;
}
.loader {
  width: 70px;
  height: 70px;
  border-radius: 50%;
  border: 6px solid transparent;
  border-top-color: #00d4ff;
  border-right-color: #8a2be2;
  animation: spin 1s linear infinite;
  background: radial-gradient(circle at center, rgba(255,255,255,0.15), transparent);
}
@keyframes spin {
  0% {transform: rotate(0deg);}
  100% {transform: rotate(360deg);}
}

/* Header */
header {
  display: flex;
  align-items: center;
  gap: 12px;
  background: rgba(0,0,40,0.7);
  backdrop-filter: blur(6px);
  padding: 12px 16px;
}
header img {height: 40px;}
header h2 {margin: 0; font-size: 1.2rem; color: #fff;}

/* VIP + Email Card */
.vip-card {
  background: rgba(30,64,175,0.8);
  border-radius: 12px;
  padding: 16px;
  margin: 16px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.vip-card .info {display: flex; flex-direction: column;}
.vip-card .user-email {font-size: 0.95rem; color: #fff; margin-bottom: 6px;}
.vip-card .vip-level {
  display: flex;
  align-items: center;
  gap: 6px;
  font-weight: 700;
  font-size: 1.2rem;
  color: #ffd700;
}
.vip-card .vip-stars {color: #ffd700;}
.vip-card img.icon {height: 40px;}

/* Balance Card */
.balance-card {
  background: rgba(139,69,19,0.8);
  border-radius: 12px;
  padding: 16px;
  margin: 16px;
  font-weight: 700;
  font-size: 1.1rem;
  color: #fff;
  display: flex;
  justify-content: space-around;
  align-items: center;
  text-align: center;
}

/* Buttons */
.buttons {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin: 16px;
}
.buttons .btn {
  width: 100%;
  padding: 12px;
  background: #1e3a8a;
  color: #fff;
  font-weight: 600;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-size: 1rem;
  text-align: left;
  transition: 0.2s;
}
.buttons .btn i {margin-right: 8px;}
.buttons .btn:hover {background: #3b82f6;}

/* Popup */
.popup {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%,-50%);
  background: #28a745;
  color: #fff;
  padding: 16px 20px;
  border-radius: 8px;
  font-weight: 600;
  z-index: 9999;
  text-align: center;
}
.popup.red {background: #cc0000;}

/* Bottom Nav */
nav {
  position: fixed;
  bottom: 0; left: 0; right: 0;
  display: flex;
  justify-content: space-around;
  background: rgba(0,0,50,0.8);
  padding: 6px 0;
  backdrop-filter: blur(8px);
}
nav a {color: #fff; text-decoration: none; text-align: center; font-size: 0.8rem;}
nav i {font-size: 18px;}
</style>
</head>

<body>
<div class="loader-overlay" id="loader">
  <div class="loader"></div>
</div>

<header>
  <img src="https://png.pngtree.com/png-clipart/20221216/original/pngtree-vip-icon-design-png-image_8749175.png" alt="VIP Icon">
  <h2>QUANTUM RIO – Profile</h2>
</header>

<div class="vip-card">
  <div class="info">
    <div class="user-email" id="user-email">loading...</div>
    <div class="vip-level">
      <span id="vip-level">VIP 0</span>
      <span class="vip-stars" id="vip-stars"></span>
    </div>
  </div>
  <img class="icon" src="https://png.pngtree.com/png-clipart/20221216/original/pngtree-vip-icon-design-png-image_8749175.png" alt="VIP">
</div>

<div class="balance-card" id="balance-card">
  <div id="total-balance">Total Balance: UGX 0</div>
  <div id="recharged-amount">Recharged: UGX 0</div>
</div>

<div class="buttons">
  <button class="btn" onclick="location.href='deposit.html'"><i class="fas fa-wallet"></i>Deposit</button>
  <button class="btn" onclick="location.href='withdraw.html'"><i class="fas fa-money-bill"></i>Withdraw</button>
  <button class="btn" onclick="location.href='transaction.html'"><i class="fas fa-history"></i>Transaction History</button>
  <button class="btn" id="change-password-btn"><i class="fas fa-key"></i>Change Password</button>
  <button class="btn" id="logout-btn"><i class="fas fa-sign-out-alt"></i>Logout</button>
</div>

<nav>
  <a href="dashboard.html"><i class="fas fa-home"></i><br>Home</a>
  <a href="task.html"><i class="fas fa-tasks"></i><br>Task</a>
  <a href="team.html"><i class="fas fa-users"></i><br>Team</a>
  <a href="vip.html"><i class="fas fa-crown"></i><br>VIP</a>
  <a href="profile.html"><i class="fas fa-user"></i><br>Me</a>
</nav>

<script>
auth.onAuthStateChanged(user => {
  if (!user) { window.location = 'signin.html'; return; }
  const uid = user.uid;
  const userRef = db.ref('users/' + uid);

  document.getElementById('user-email').textContent = user.email;

  // VIP level
  userRef.child('vipLevels').on('value', snap => {
    const vipUnlocked = snap.val() || [];
    let level = 0;
    if (Array.isArray(vipUnlocked)) {
      const nums = vipUnlocked.filter(n => typeof n === 'number');
      if (nums.length > 0) level = Math.max(...nums);
    } else if (typeof vipUnlocked === 'object') {
      const nums = Object.keys(vipUnlocked).map(n => parseInt(n)).filter(n => !isNaN(n));
      if (nums.length > 0) level = Math.max(...nums);
    }
    document.getElementById('vip-level').textContent = `VIP ${level}`;
    document.getElementById('vip-stars').textContent = '★'.repeat(level);
  });

  // Balances
  userRef.child('balance').on('value', snap => {
    const bal = parseFloat(snap.val() || 0);
    document.getElementById('total-balance').textContent =
      `Total Balance: UGX ${bal.toLocaleString(undefined, { minimumFractionDigits: 2 })}`;
  });

  userRef.child('recharged').on('value', snap => {
    const rech = parseFloat(snap.val() || 0);
    document.getElementById('recharged-amount').textContent =
      `Recharged: UGX ${rech.toLocaleString(undefined, { minimumFractionDigits: 2 })}`;
    document.getElementById('loader').style.opacity = '0';
    setTimeout(()=>document.getElementById('loader').remove(),400);
  });

  // Change Password
  document.getElementById('change-password-btn').onclick = () => {
    auth.sendPasswordResetEmail(user.email)
      .then(()=>showPopup('✅ Password reset email sent'))
      .catch(()=>showPopup('❌ Error sending reset email', true));
  };

  // Logout
  document.getElementById('logout-btn').onclick = () => {
    auth.signOut().then(() => {
      showPopup('✅ Logged out');
      setTimeout(()=>window.location='signin.html',1500);
    }).catch(()=>showPopup('❌ Logout failed',true));
  };
});

// Popup
function showPopup(msg, red=false){
  const p=document.createElement('div');
  p.className='popup'+(red?' red':'');
  p.textContent=msg;
  document.body.appendChild(p);
  setTimeout(()=>p.remove(),3000);
}
</script>
</body>
</html>
